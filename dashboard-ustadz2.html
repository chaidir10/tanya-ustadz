<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard Ustadz - Tanya Ustadz (Voice Note) dengan Pagination</title>

<!-- Import Poppins font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet" />

<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #e9f0f2;
    margin: 0; padding: 1.5rem;
    color: #222;
    min-height: 100vh;
  }
  header {
    text-align: center;
    margin-bottom: 1.8rem;
    color: #0a9396;
    user-select: none;
  }
  header h1 {
    font-size: 2.4rem;
    font-weight: 800;
    letter-spacing: 1.2px;
    margin: 0 0 0.3rem;
    text-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  header p {
    font-size: 1.1rem;
    font-weight: 600;
    color: #056754;
  }
  /* Filter bar */
  #filterBar {
    max-width: 720px;
    margin: 0 auto 1.8rem auto;
    display: flex;
    justify-content: center;
    gap: 1rem;
  }
  #filterBar button {
    background: #0a9396;
    color: white;
    border: none;
    border-radius: 14px;
    padding: 10px 18px;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    box-shadow: 0 5px 15px rgb(10 147 150 / 0.5);
    transition: background-color 0.3s ease, transform 0.15s ease;
    user-select: none;
  }
  #filterBar button:hover {
    background: #056754;
    transform: translateY(-2px);
  }
  #filterBar button.active {
    background: #056754;
    box-shadow: 0 6px 18px rgb(5 103 84 / 0.8);
  }
  /* Questions container */
  #questions {
    max-width: 720px;
    margin: 0 auto 1.5rem auto;
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }
  .card {
    background: #fff;
    border-radius: 16px;
    padding: 1.25rem 2rem 1.5rem 1.75rem;
    box-shadow: 0 6px 18px rgb(0 0 0 / 0.08);
    position: relative;
    transition: background-color 0.3s ease, box-shadow 0.25s ease;
    border-left: 6px solid #0a9396;
  }
  .card:hover {
    box-shadow: 0 10px 30px rgb(0 0 0 / 0.12);
  }
  .card.answered {
    background-color: #d4f7dc;
    border-left-color: #056754;
  }
  .card h3 {
    margin: 0;
    font-weight: 700;
    color: #0a9396;
    font-size: 1.3rem;
    letter-spacing: 0.03em;
  }
  .question-meta {
    font-size: 0.85rem;
    color: #666;
    margin: 0.3rem 0 0.8rem;
  }
  .question-text {
    font-weight: 600;
    margin: 0.45rem 0 1rem;
    font-size: 1.05rem;
    line-height: 1.4;
    color: #333;
  }
  .status {
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 0.7rem;
  }
  .status.unanswered {
    color: #b33;
  }
  .status.answered {
    color: #056754;
  }
  .answer-text {
    font-size: 0.95rem;
    line-height: 1.35;
    margin-bottom: 1rem;
    color: #254117;
    white-space: pre-wrap;
  }
  .answer-voice {
    margin-bottom: 1rem;
  }
  .answer-voice audio {
    width: 100%;
    border-radius: 8px;
  }
  .answer-added {
    margin-top: 0.7rem;
    padding-left: 1rem;
    border-left: 3px solid #0a9396;
    color: #14532d;
    font-size: 0.9rem;
    font-style: italic;
    white-space: pre-wrap;
  }
  /* Button Jawab / Tambah Jawaban */
  .btn-jawab {
    position: absolute;
    top: 1.2rem;
    right: 1.3rem;
    background: #0a9396;
    color: #fff;
    border: none;
    border-radius: 12px;
    padding: 8px 16px;
    font-weight: 700;
    font-size: 0.9rem;
    cursor: pointer;
    box-shadow: 0 4px 10px rgb(10 147 150 / 0.4);
    transition: background-color 0.25s ease, transform 0.15s ease;
    user-select: none;
  }
  .btn-jawab:hover {
    background: #056754;
    transform: translateY(-2px);
  }
  .btn-jawab:active {
    transform: translateY(0);
  }
  /* Modal */
  .modal {
    display: none;
    position: fixed;
    z-index: 1100;
    inset: 0;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(3px);
    justify-content: center;
    align-items: center;
    padding: 1rem;
  }
  .modal.active {
    display: flex;
  }
  .modal-content {
    background: white;
    border-radius: 16px;
    max-width: 520px;
    width: 100%;
    box-shadow: 0 14px 40px rgb(0 0 0 / 0.25);
    padding: 2rem 2.5rem 2.5rem;
    position: relative;
  }
  .modal-content h2 {
    margin-top: 0;
    margin-bottom: 0.3rem;
    font-weight: 800;
    color: #0a9396;
    font-size: 1.8rem;
    letter-spacing: 0.04em;
  }
  .modal-content strong#modalTema {
    display: inline-block;
    margin-bottom: 0.8rem;
    color: #056754;
    font-size: 1.1rem;
  }
  .modal-content em#modalPertanyaan {
    display: block;
    font-style: italic;
    color: #444;
    font-size: 1.05rem;
    margin-bottom: 1.2rem;
  }
  /* Form controls */
  label {
    font-weight: 600;
    color: #056754;
    display: block;
    margin-bottom: 0.3rem;
    font-size: 1rem;
  }
  textarea {
    width: 100%;
    min-height: 120px;
    padding: 0.75rem 1rem;
    font-size: 1rem;
    border-radius: 12px;
    border: 2px solid #b7d9da;
    background-color: #f9fdfa;
    resize: vertical;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    font-family: 'Poppins', sans-serif;
  }
  textarea:focus {
    outline: none;
    border-color: #0a9396;
    box-shadow: 0 0 10px rgba(10,147,150,0.5);
    background-color: #f1f9f9;
  }
  /* Modal buttons */
  .modal-buttons {
    margin-top: 1.8rem;
    text-align: right;
  }
  .modal-buttons button {
    font-weight: 700;
    border: none;
    padding: 0.55rem 1.4rem;
    border-radius: 12px;
    cursor: pointer;
    font-size: 1rem;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .modal-buttons button.submit {
    background: #0a9396;
    color: white;
    margin-left: 0.8rem;
    box-shadow: 0 5px 15px rgb(10 147 150 / 0.5);
  }
  .modal-buttons button.submit:hover {
    background: #056754;
  }
  .modal-buttons button.cancel {
    background: #bbb;
    color: #444;
    box-shadow: 0 4px 12px rgb(0 0 0 / 0.15);
  }
  .modal-buttons button.cancel:hover {
    background: #999;
  }
  /* Voice Recorder */
  .voice-controls {
    margin-top: 1rem;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
  }
  .voice-btn {
    flex: 1 1 90px;
    border: none;
    background: #0a9396;
    color: white;
    padding: 10px 18px;
    font-weight: 700;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 5px 15px rgb(10 147 150 / 0.4);
    transition: background-color 0.3s ease, transform 0.15s ease;
    user-select: none;
    text-align: center;
  }
  .voice-btn:hover:not(:disabled) {
    background: #056754;
    transform: translateY(-1.5px);
  }
  .voice-btn:disabled {
    background: #7bb3b8;
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
  }
  audio#audioPlayback {
    margin-top: 0.6rem;
    width: 100%;
    border-radius: 12px;
    outline: none;
    box-shadow: 0 3px 12px rgb(0 0 0 / 0.12);
  }
  /* Pagination */
  #pagination {
    max-width: 720px;
    margin: 0 auto 3rem auto;
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    flex-wrap: wrap;
    user-select: none;
  }
  #pagination button {
    background: #0a9396;
    color: white;
    border: none;
    border-radius: 12px;
    padding: 8px 14px;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    box-shadow: 0 5px 15px rgb(10 147 150 / 0.5);
    transition: background-color 0.3s ease;
  }
  #pagination button:hover:not(:disabled) {
    background: #056754;
  }
  #pagination button:disabled {
    background: #7bb3b8;
    cursor: default;
    box-shadow: none;
  }
  #pagination button.active {
    background: #056754;
    box-shadow: 0 6px 18px rgb(5 103 84 / 0.8);
  }
  /* Responsive */
  @media (max-width: 640px) {
    body {
      padding: 1rem 1rem 1.5rem;
    }
    #filterBar {
      gap: 0.6rem;
      flex-wrap: wrap;
    }
    #filterBar button {
      flex: 1 1 calc(33% - 0.6rem);
      font-size: 0.95rem;
      padding: 8px 12px;
    }
    #questions {
      max-width: 100%;
    }
    .card {
      padding: 1.1rem 1.4rem 1.4rem 1.4rem;
      border-left-width: 5px;
    }
    .btn-jawab {
      top: 1rem;
      right: 1rem;
      padding: 6px 14px;
      font-size: 0.85rem;
      border-radius: 10px;
    }
    .modal-content {
      padding: 1.6rem 1.8rem 2rem;
      border-radius: 14px;
    }
    .voice-btn {
      flex: 1 1 45%;
      padding: 8px 14px;
      font-size: 0.95rem;
    }
    textarea {
      min-height: 100px;
      font-size: 0.95rem;
    }
  }
  .form-group {
  max-width: 640px;
  margin: 0 auto 1rem auto;
}
textarea {
  width: 100%;
  min-height: 120px;
  padding: 0.75rem 1rem;
  font-size: 1rem;
  border-radius: 12px;
  border: 2px solid #b7d9da;
  background-color: #f9fdfa;
  resize: vertical;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
  font-family: 'Poppins', sans-serif;
  box-sizing: border-box;
}
</style>
</head>
<body>

<header>
  <h1>Dashboard Ustadz</h1>
  <p>Ahlan wa sahlan! <strong>Ustadz Muhammad Hafizh</strong></p>
</header>

<!-- Filter Buttons -->
<div id="filterBar" role="toolbar" aria-label="Filter Pertanyaan">
  <button type="button" class="active" data-filter="all" aria-pressed="true">Semua</button>
  <button type="button" data-filter="answered" aria-pressed="false">Sudah Dijawab</button>
  <button type="button" data-filter="unanswered" aria-pressed="false">Belum Dijawab</button>
</div>

<div id="questions" aria-live="polite" aria-atomic="true"></div>

<!-- Pagination -->
<div id="pagination" role="navigation" aria-label="Navigasi halaman pertanyaan"></div>

<!-- Modal Jawab -->
<div id="modalJawab" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal-content" role="document">
    <h2 id="modalTitle">Jawab Pertanyaan</h2>
    <strong id="modalTema"></strong>
    <em id="modalPertanyaan"></em>

    <div class="form-group">
  <label for="jawabanInput">Jawaban Teks:</label>
  <textarea id="jawabanInput" placeholder="Tulis jawaban di sini..."></textarea>
</div>

    <label>Atau rekam jawaban suara (voice note):</label>
    <div class="voice-controls">
      <button class="voice-btn" id="btnRecord" type="button">Rekam</button>
      <button class="voice-btn" id="btnStop" type="button" disabled>Berhenti</button>
      <button class="voice-btn" id="btnPlay" type="button" disabled>Putar</button>
      <button class="voice-btn" id="btnDelete" type="button" disabled>Hapus</button>
    </div>
    <audio id="audioPlayback" controls style="display:none;"></audio>

    <div class="modal-buttons">
      <button class="cancel" id="btnCancel" type="button">Batal</button>
      <button class="submit" id="btnSubmit" type="button">Simpan Jawaban</button>
    </div>
  </div>
</div>

<script>
  const ustadzLogin = 'Ustadz Muhammad Hafizh';

  // Generate dummy data 20 questions
  const generateDummyQuestions = () => {
    const temas = ['Fiqih', 'Aqidah', 'Tauhid', 'Hadits', 'Tafsir'];
    const teksSamples = [
      'Bolehkah shalat dengan celana pendek?',
      'Apakah Allah berada di atas Arsy?',
      'Apa perbedaan syirik besar dan kecil?',
      'Apa hukum hadits dhaif?',
      'Bagaimana cara berwudhu yang benar?',
      'Apa itu takwil dalam tafsir?',
      'Bagaimana hukum memakan hewan halal?',
      'Apa syarat sah shalat?',
      'Bagaimana cara menjaga hati dari riya?',
      'Apa itu dzikir pagi dan petang?',
    ];
    const jawabanSamples = [
      'Tidak disunnahkan, hendaknya menggunakan pakaian yang menutup aurat.',
      'Allah berada di atas Arsy sesuai dengan sifat-Nya tanpa menyerupai makhluk.',
      'Syirik besar mengeluarkan pelakunya dari Islam, sedangkan syirik kecil tidak.',
      'Hadits dhaif tidak dijadikan hujjah dalam masalah aqidah.',
      'Berwudhu dimulai dengan niat, membasuh muka, tangan sampai siku, mengusap kepala, dan membasuh kaki.',
      'Takwil adalah tafsir makna ayat yang tersembunyi berdasarkan ilmu dan dalil yang shahih.',
      'Hukum memakan hewan halal adalah wajib mengikuti aturan syariat, seperti menyembelih secara benar.',
      'Syarat sah shalat termasuk suci dari hadas, menutup aurat, dan menghadap kiblat.',
      'Menjaga hati dari riya dengan ikhlas dalam ibadah dan selalu introspeksi niat.',
      'Dzikir pagi dan petang dianjurkan untuk menguatkan iman dan memohon perlindungan Allah.',
    ];
    const questions = [];
    const now = Date.now();

    for (let i = 0; i < 20; i++) {
      const tema = temas[i % temas.length];
      const teks = teksSamples[i % teksSamples.length];
      const kode = `Q${(1000 + i).toString().padStart(4,'0')}`;
      const tanggal = new Date(now - i * 3600 * 1000).toISOString(); // per jam mundur
      const answered = (i % 3 === 0); // tiap 3 pertanyaan ada jawaban
      const jawaban = answered ? jawabanSamples[i % jawabanSamples.length] : '';
      const jawabUstadz = answered ? ustadzLogin : '';
      const voiceNote = answered && i % 6 === 0 ? 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3' : ''; // dummy audio url for beberapa jawaban

      const tambahanJawaban = answered && i % 5 === 0 ? [
        { ustadz: 'Ustadz Ahmad', teks: 'Tambahan penjelasan tentang topik.' },
        { ustadz: 'Ustadz Ali', teks: 'Perlu diperhatikan juga bahwa...' }
      ] : [];

      questions.push({
        tema, teks, kode, tanggal,
        jawaban, jawabUstadz, voiceNote,
        tambahanJawaban,
      });
    }
    return questions;
  };

  let questions = generateDummyQuestions();

  // Pagination vars
  const questionsPerPage = 5;
  let currentPage = 1;
  let currentFilter = 'all';

  // Modal elements
  const modal = document.getElementById('modalJawab');
  const modalTema = document.getElementById('modalTema');
  const modalPertanyaan = document.getElementById('modalPertanyaan');
  const jawabanInput = document.getElementById('jawabanInput');
  const btnCancel = document.getElementById('btnCancel');
  const btnSubmit = document.getElementById('btnSubmit');
  const btnRecord = document.getElementById('btnRecord');
  const btnStop = document.getElementById('btnStop');
  const btnPlay = document.getElementById('btnPlay');
  const btnDelete = document.getElementById('btnDelete');
  const audioPlayback = document.getElementById('audioPlayback');

  let currentIndex = null;
  let mediaRecorder = null;
  let audioChunks = [];
  let audioBlobUrl = null;

  // Format date to Indonesian with WIB timezone (UTC+7)
  function formatWaktu(tanggalISO) {
    const options = {
      year: 'numeric', month: 'long', day: 'numeric',
      hour: '2-digit', minute: '2-digit',
      hour12: false,
      timeZone: 'Asia/Jakarta',
    };
    const dt = new Date(tanggalISO);
    return dt.toLocaleString('id-ID', options) + ' WIB';
  }

  // Filter questions by currentFilter
  function getFilteredQuestions() {
    if (currentFilter === 'all') return questions;
    if (currentFilter === 'answered') return questions.filter(q => q.jawaban && q.jawaban.trim() !== '');
    if (currentFilter === 'unanswered') return questions.filter(q => !q.jawaban || q.jawaban.trim() === '');
    return questions;
  }

  // Render questions on current page & filter
  function renderQuestions() {
    const container = document.getElementById('questions');
    container.innerHTML = '';

    const filtered = getFilteredQuestions();

    // Pagination calculation
    const totalPages = Math.ceil(filtered.length / questionsPerPage);
    if (currentPage > totalPages) currentPage = totalPages || 1;

    const startIdx = (currentPage - 1) * questionsPerPage;
    const pageItems = filtered.slice(startIdx, startIdx + questionsPerPage);

    pageItems.forEach((q, i) => {
      const waktuFormat = formatWaktu(q.tanggal);
      const card = document.createElement('div');
      card.className = 'card';
      if (q.jawaban && q.jawaban.trim() !== '') card.classList.add('answered');
      card.dataset.index = questions.indexOf(q);

      const statusClass = q.jawaban && q.jawaban.trim() !== '' ? 'answered' : 'unanswered';
      const statusText = q.jawaban && q.jawaban.trim() !== ''
        ? `Sudah dijawab oleh <strong>${q.jawabUstadz}</strong>`
        : '<span>Belum dijawab</span>';

      card.innerHTML = `
        <h3>${q.tema}</h3>
        <div class="question-meta">
          <strong>Kode:</strong> ${q.kode} &nbsp;|&nbsp; <strong>Tanggal & Waktu Tanya:</strong> ${waktuFormat}
        </div>
        <div class="question-text">${q.teks}</div>
        <div class="status ${statusClass}">${statusText}</div>
        ${q.jawaban && q.jawaban.trim() !== '' ? `<div class="answer-text">${q.jawaban}</div>` : ''}
        ${q.voiceNote ? `<div class="answer-voice"><audio controls src="${q.voiceNote}"></audio></div>` : ''}
        ${q.tambahanJawaban && q.tambahanJawaban.length > 0 ? q.tambahanJawaban.map(tj => `
          <div class="answer-added">Tambahan dari <strong>${tj.ustadz}</strong>: ${tj.teks}</div>
        `).join('') : ''}
        <button class="btn-jawab" aria-label="${q.jawaban ? 'Tambah Jawaban' : 'Jawab Pertanyaan'}">
          ${q.jawaban ? 'Tambah Jawaban' : 'Jawab'}
        </button>
      `;
      container.appendChild(card);
    });

    // Add event listeners for jawab buttons
    container.querySelectorAll('.btn-jawab').forEach(btn => {
      btn.addEventListener('click', openModal);
    });

    renderPagination(totalPages);
  }

  // Render pagination buttons
  function renderPagination(totalPages) {
    const pagContainer = document.getElementById('pagination');
    pagContainer.innerHTML = '';

    if (totalPages <= 1) return; // no pagination if 1 or less

    // Prev button
    const btnPrev = document.createElement('button');
    btnPrev.textContent = 'Prev';
    btnPrev.disabled = currentPage === 1;
    btnPrev.addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        renderQuestions();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    });
    pagContainer.appendChild(btnPrev);

    // Page numbers (limit display to max 7 pages, with ellipsis)
    let startPage = Math.max(1, currentPage - 3);
    let endPage = Math.min(totalPages, currentPage + 3);

    if (currentPage <= 4) {
      endPage = Math.min(7, totalPages);
    }
    if (currentPage > totalPages - 4) {
      startPage = Math.max(totalPages - 6, 1);
    }

    if (startPage > 1) {
      const btnFirst = document.createElement('button');
      btnFirst.textContent = '1';
      btnFirst.addEventListener('click', () => {
        currentPage = 1;
        renderQuestions();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
      pagContainer.appendChild(btnFirst);

      if (startPage > 2) {
        const ellipsis1 = document.createElement('span');
        ellipsis1.textContent = '...';
        ellipsis1.style.padding = '0 6px';
        ellipsis1.style.userSelect = 'none';
        pagContainer.appendChild(ellipsis1);
      }
    }

    for (let i = startPage; i <= endPage; i++) {
      const btnPage = document.createElement('button');
      btnPage.textContent = i;
      if (i === currentPage) btnPage.classList.add('active');
      btnPage.addEventListener('click', () => {
        currentPage = i;
        renderQuestions();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
      pagContainer.appendChild(btnPage);
    }

    if (endPage < totalPages) {
      if (endPage < totalPages - 1) {
        const ellipsis2 = document.createElement('span');
        ellipsis2.textContent = '...';
        ellipsis2.style.padding = '0 6px';
        ellipsis2.style.userSelect = 'none';
        pagContainer.appendChild(ellipsis2);
      }
      const btnLast = document.createElement('button');
      btnLast.textContent = totalPages;
      btnLast.addEventListener('click', () => {
        currentPage = totalPages;
        renderQuestions();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
      pagContainer.appendChild(btnLast);
    }

    // Next button
    const btnNext = document.createElement('button');
    btnNext.textContent = 'Next';
    btnNext.disabled = currentPage === totalPages;
    btnNext.addEventListener('click', () => {
      if (currentPage < totalPages) {
        currentPage++;
        renderQuestions();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    });
    pagContainer.appendChild(btnNext);
  }

  // Open modal function
  function openModal(e) {
    const btn = e.currentTarget;
    const card = btn.closest('.card');
    currentIndex = parseInt(card.dataset.index);

    const q = questions[currentIndex];

    modalTema.textContent = q.tema;
    modalPertanyaan.textContent = q.teks;
    jawabanInput.value = q.jawaban || '';

    // Reset voice note UI
    stopRecording();
    resetAudio();

    // If voiceNote exists, load it
    if(q.voiceNote) {
      audioPlayback.src = q.voiceNote;
      audioPlayback.style.display = 'block';
      btnPlay.disabled = false;
      btnDelete.disabled = false;
    } else {
      audioPlayback.style.display = 'none';
      btnPlay.disabled = true;
      btnDelete.disabled = true;
    }

    modal.classList.add('active');
    jawabanInput.focus();
  }

  // Close modal
  function closeModal() {
    modal.classList.remove('active');
    currentIndex = null;
    jawabanInput.value = '';
    stopRecording();
    resetAudio();
  }

  btnCancel.addEventListener('click', closeModal);

  btnSubmit.addEventListener('click', () => {
    if (currentIndex === null) return;

    const jawabanText = jawabanInput.value.trim();
    if (!jawabanText && !audioBlobUrl) {
      alert('Silakan isi jawaban teks atau rekam voice note terlebih dahulu.');
      return;
    }

    const q = questions[currentIndex];
    q.jawaban = jawabanText;
    q.jawabUstadz = ustadzLogin;
    if (audioBlobUrl) {
      q.voiceNote = audioBlobUrl;
    }

    closeModal();
    renderQuestions();
  });

  // Voice recording setup
  async function startRecording() {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      alert('Browser Anda tidak mendukung perekaman suara.');
      return;
    }
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];
      mediaRecorder.start();

      mediaRecorder.addEventListener('dataavailable', event => {
        audioChunks.push(event.data);
      });

      mediaRecorder.addEventListener('stop', () => {
        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
        if (audioBlobUrl) {
          URL.revokeObjectURL(audioBlobUrl);
        }
        audioBlobUrl = URL.createObjectURL(audioBlob);
        audioPlayback.src = audioBlobUrl;
        audioPlayback.style.display = 'block';
        btnPlay.disabled = false;
        btnDelete.disabled = false;
      });

      btnRecord.disabled = true;
      btnStop.disabled = false;
      btnPlay.disabled = true;
      btnDelete.disabled = true;
      jawabanInput.disabled = true;

    } catch (err) {
      alert('Gagal mengakses mikrofon: ' + err.message);
    }
  }

  function stopRecording() {
    if (mediaRecorder && mediaRecorder.state !== 'inactive') {
      mediaRecorder.stop();
      mediaRecorder.stream.getTracks().forEach(track => track.stop());
    }
    btnRecord.disabled = false;
    btnStop.disabled = true;
    jawabanInput.disabled = false;
  }

  function resetAudio() {
    if (audioBlobUrl) {
      URL.revokeObjectURL(audioBlobUrl);
      audioBlobUrl = null;
    }
    audioPlayback.src = '';
    audioPlayback.style.display = 'none';
    btnPlay.disabled = true;
    btnDelete.disabled = true;
  }

  btnRecord.addEventListener('click', startRecording);
  btnStop.addEventListener('click', stopRecording);
  btnPlay.addEventListener('click', () => {
    if (audioPlayback.src) {
      audioPlayback.play();
    }
  });
  btnDelete.addEventListener('click', () => {
    resetAudio();
  });

  // Filter buttons logic
  const filterButtons = document.querySelectorAll('#filterBar button');
  filterButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      filterButtons.forEach(b => {
        b.classList.remove('active');
        b.setAttribute('aria-pressed', 'false');
      });
      btn.classList.add('active');
      btn.setAttribute('aria-pressed', 'true');

      currentFilter = btn.dataset.filter;
      currentPage = 1;
      renderQuestions();
    });
  });

  // Initial render
  renderQuestions();

</script>

</body>
</html>
